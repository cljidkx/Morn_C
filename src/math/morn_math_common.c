/*
Copyright (C) 2019-2020 JingWeiZhangHuai <jingweizhanghuai@163.com>
Licensed under the Apache License, Version 2.0; you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
*/

#include "morn_math.h"

char morn_float_sup[8] = {0x7f,0x7f,0x7f,0x7f,0x7f,0x7f,0x7f,0x7f};
char morn_float_inf[8] = {0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe,0xfe};

double morn_sin0[450]={0.000000000000000,0.017452406437284,0.034899496702501,0.052335956242944,0.069756473744125,0.087155742747658,0.104528463267653,0.121869343405147,0.139173100960065,0.156434465040231,0.173648177666930,0.190808995376545,0.207911690817759,0.224951054343865,0.241921895599668,0.258819045102521,0.275637355816999,0.292371704722737,0.309016994374947,0.325568154457157,0.342020143325669,0.358367949545300,0.374606593415912,0.390731128489274,0.406736643075800,0.422618261740699,0.438371146789077,0.453990499739547,0.469471562785891,0.484809620246337,0.500000000000000,0.515038074910054,0.529919264233205,0.544639035015027,0.559192903470747,0.573576436351046,0.587785252292473,0.601815023152048,0.615661475325658,0.629320391049837,0.642787609686539,0.656059028990507,0.669130606358858,0.681998360062498,0.694658370458997,0.707106781186547,0.719339800338651,0.731353701619170,0.743144825477394,0.754709580222772,0.766044443118978,0.777145961456971,0.788010753606722,0.798635510047293,0.809016994374947,0.819152044288992,0.829037572555042,0.838670567945424,0.848048096156426,0.857167300702112,0.866025403784439,0.874619707139396,0.882947592858927,0.891006524188368,0.898794046299167,0.906307787036650,0.913545457642601,0.920504853452440,0.927183854566787,0.933580426497202,0.939692620785908,0.945518575599317,0.951056516295154,0.956304755963035,0.961261695938319,0.965925826289068,0.970295726275996,0.974370064785235,0.978147600733806,0.981627183447664,0.984807753012208,0.987688340595138,0.990268068741570,0.992546151641322,0.994521895368273,0.996194698091746,0.997564050259824,0.998629534754574,0.999390827019096,0.999847695156391,1.000000000000000,0.999847695156391,0.999390827019096,0.998629534754574,0.997564050259824,0.996194698091746,0.994521895368273,0.992546151641322,0.990268068741570,0.987688340595138,0.984807753012208,0.981627183447664,0.978147600733806,0.974370064785235,0.970295726275996,0.965925826289068,0.961261695938319,0.956304755963036,0.951056516295154,0.945518575599317,0.939692620785908,0.933580426497202,0.927183854566787,0.920504853452440,0.913545457642601,0.906307787036650,0.898794046299167,0.891006524188368,0.882947592858927,0.874619707139396,0.866025403784439,0.857167300702112,0.848048096156426,0.838670567945424,0.829037572555042,0.819152044288992,0.809016994374947,0.798635510047293,0.788010753606722,0.777145961456971,0.766044443118978,0.754709580222772,0.743144825477394,0.731353701619171,0.719339800338651,0.707106781186548,0.694658370458997,0.681998360062499,0.669130606358858,0.656059028990507,0.642787609686539,0.629320391049838,0.615661475325658,0.601815023152048,0.587785252292473,0.573576436351046,0.559192903470747,0.544639035015027,0.529919264233205,0.515038074910054,0.500000000000000,0.484809620246337,0.469471562785891,0.453990499739547,0.438371146789077,0.422618261740699,0.406736643075800,0.390731128489274,0.374606593415912,0.358367949545300,0.342020143325669,0.325568154457157,0.309016994374948,0.292371704722737,0.275637355817000,0.258819045102521,0.241921895599668,0.224951054343865,0.207911690817759,0.190808995376545,0.173648177666930,0.156434465040231,0.139173100960066,0.121869343405148,0.104528463267654,0.087155742747659,0.069756473744126,0.052335956242944,0.034899496702501,0.017452406437283,0.000000000000000,-0.017452406437283,-0.034899496702501,-0.052335956242944,-0.069756473744125,-0.087155742747658,-0.104528463267653,-0.121869343405148,-0.139173100960066,-0.156434465040231,-0.173648177666930,-0.190808995376545,-0.207911690817759,-0.224951054343865,-0.241921895599668,-0.258819045102520,-0.275637355816999,-0.292371704722736,-0.309016994374948,-0.325568154457157,-0.342020143325669,-0.358367949545300,-0.374606593415912,-0.390731128489274,-0.406736643075800,-0.422618261740699,-0.438371146789077,-0.453990499739546,-0.469471562785891,-0.484809620246337,-0.500000000000000,-0.515038074910054,-0.529919264233205,-0.544639035015027,-0.559192903470747,-0.573576436351046,-0.587785252292473,-0.601815023152048,-0.615661475325658,-0.629320391049838,-0.642787609686539,-0.656059028990507,-0.669130606358858,-0.681998360062498,-0.694658370458997,-0.707106781186547,-0.719339800338651,-0.731353701619170,-0.743144825477394,-0.754709580222772,-0.766044443118978,-0.777145961456971,-0.788010753606722,-0.798635510047293,-0.809016994374947,-0.819152044288992,-0.829037572555041,-0.838670567945424,-0.848048096156426,-0.857167300702112,-0.866025403784438,-0.874619707139396,-0.882947592858927,-0.891006524188368,-0.898794046299167,-0.906307787036650,-0.913545457642601,-0.920504853452440,-0.927183854566787,-0.933580426497202,-0.939692620785908,-0.945518575599317,-0.951056516295154,-0.956304755963035,-0.961261695938319,-0.965925826289068,-0.970295726275996,-0.974370064785235,-0.978147600733806,-0.981627183447664,-0.984807753012208,-0.987688340595138,-0.990268068741570,-0.992546151641322,-0.994521895368273,-0.996194698091746,-0.997564050259824,-0.998629534754574,-0.999390827019096,-0.999847695156391,-1.000000000000000,-0.999847695156391,-0.999390827019096,-0.998629534754574,-0.997564050259824,-0.996194698091746,-0.994521895368273,-0.992546151641322,-0.990268068741570,-0.987688340595138,-0.984807753012208,-0.981627183447664,-0.978147600733806,-0.974370064785235,-0.970295726275997,-0.965925826289068,-0.961261695938319,-0.956304755963035,-0.951056516295154,-0.945518575599317,-0.939692620785909,-0.933580426497202,-0.927183854566787,-0.920504853452440,-0.913545457642601,-0.906307787036650,-0.898794046299167,-0.891006524188368,-0.882947592858927,-0.874619707139396,-0.866025403784439,-0.857167300702112,-0.848048096156426,-0.838670567945424,-0.829037572555042,-0.819152044288992,-0.809016994374948,-0.798635510047293,-0.788010753606722,-0.777145961456971,-0.766044443118978,-0.754709580222772,-0.743144825477395,-0.731353701619171,-0.719339800338652,-0.707106781186548,-0.694658370458998,-0.681998360062498,-0.669130606358858,-0.656059028990507,-0.642787609686540,-0.629320391049838,-0.615661475325659,-0.601815023152048,-0.587785252292473,-0.573576436351046,-0.559192903470747,-0.544639035015027,-0.529919264233206,-0.515038074910054,-0.500000000000000,-0.484809620246337,-0.469471562785891,-0.453990499739547,-0.438371146789077,-0.422618261740700,-0.406736643075800,-0.390731128489275,-0.374606593415912,-0.358367949545301,-0.342020143325669,-0.325568154457158,-0.309016994374948,-0.292371704722736,-0.275637355817000,-0.258819045102521,-0.241921895599668,-0.224951054343865,-0.207911690817760,-0.190808995376545,-0.173648177666931,-0.156434465040231,-0.139173100960066,-0.121869343405148,-0.104528463267653,-0.087155742747658,-0.069756473744125,-0.052335956242944,-0.034899496702501,-0.017452406437284,0.000000000000000,0.017452406437283,0.034899496702500,0.052335956242944,0.069756473744125,0.087155742747659,0.104528463267653,0.121869343405148,0.139173100960065,0.156434465040231,0.173648177666930,0.190808995376545,0.207911690817759,0.224951054343865,0.241921895599668,0.258819045102520,0.275637355816999,0.292371704722737,0.309016994374947,0.325568154457156,0.342020143325669,0.358367949545299,0.374606593415912,0.390731128489273,0.406736643075800,0.422618261740700,0.438371146789077,0.453990499739547,0.469471562785890,0.484809620246337,0.499999999999999,0.515038074910054,0.529919264233205,0.544639035015027,0.559192903470746,0.573576436351046,0.587785252292474,0.601815023152048,0.615661475325658,0.629320391049837,0.642787609686539,0.656059028990507,0.669130606358858,0.681998360062498,0.694658370458997,0.707106781186547,0.719339800338651,0.731353701619171,0.743144825477394,0.754709580222772,0.766044443118978,0.777145961456971,0.788010753606721,0.798635510047293,0.809016994374947,0.819152044288991,0.829037572555042,0.838670567945424,0.848048096156426,0.857167300702112,0.866025403784439,0.874619707139395,0.882947592858927,0.891006524188368,0.898794046299167,0.906307787036650,0.913545457642601,0.920504853452441,0.927183854566787,0.933580426497202,0.939692620785908,0.945518575599317,0.951056516295154,0.956304755963036,0.961261695938319,0.965925826289068,0.970295726275996,0.974370064785235,0.978147600733806,0.981627183447664,0.984807753012208,0.987688340595138,0.990268068741570,0.992546151641322,0.994521895368273,0.996194698091745,0.997564050259824,0.998629534754574,0.999390827019096,0.999847695156391};
double *morn_cos0=morn_sin0+90;
double morn_sin1[100]={-0.008726535498374,-0.008552009086827,-0.008377482414771,-0.008202955487522,-0.008028428310396,-0.007853900888711,-0.007679373227783,-0.007504845332927,-0.007330317209461,-0.007155788862700,-0.006981260297962,-0.006806731520562,-0.006632202535817,-0.006457673349044,-0.006283143965559,-0.006108614390678,-0.005934084629719,-0.005759554687997,-0.005585024570828,-0.005410494283530,-0.005235963831420,-0.005061433219812,-0.004886902454025,-0.004712371539373,-0.004537840481175,-0.004363309284747,-0.004188777955404,-0.004014246498464,-0.003839714919243,-0.003665183223057,-0.003490651415224,-0.003316119501059,-0.003141587485880,-0.002967055375002,-0.002792523173742,-0.002617990887418,-0.002443458521345,-0.002268926080840,-0.002094393571219,-0.001919860997800,-0.001745328365898,-0.001570795680831,-0.001396262947914,-0.001221730172465,-0.001047197359800,-0.000872664515235,-0.000698131644088,-0.000523598751674,-0.000349065843310,-0.000174532924313,0.000000000000000,0.000174532924313,0.000349065843310,0.000523598751674,0.000698131644088,0.000872664515235,0.001047197359800,0.001221730172465,0.001396262947914,0.001570795680831,0.001745328365898,0.001919860997800,0.002094393571219,0.002268926080840,0.002443458521345,0.002617990887418,0.002792523173743,0.002967055375002,0.003141587485880,0.003316119501059,0.003490651415224,0.003665183223057,0.003839714919243,0.004014246498464,0.004188777955404,0.004363309284747,0.004537840481175,0.004712371539373,0.004886902454025,0.005061433219812,0.005235963831420,0.005410494283531,0.005585024570828,0.005759554687997,0.005934084629719,0.006108614390678,0.006283143965559,0.006457673349044,0.006632202535817,0.006806731520562,0.006981260297962,0.007155788862700,0.007330317209461,0.007504845332927,0.007679373227783,0.007853900888711,0.008028428310396,0.008202955487522,0.008377482414771,0.008552009086827};
double morn_cos1[100]={0.999961923064171,0.999963430901640,0.999964908278481,0.999966355194648,0.999967771650099,0.999969157644790,0.999970513178678,0.999971838251722,0.999973132863883,0.999974397015120,0.999975630705395,0.999976833934670,0.999978006702909,0.999979149010077,0.999980260856137,0.999981342241057,0.999982393164803,0.999983413627344,0.999984403628648,0.999985363168686,0.999986292247427,0.999987190864844,0.999988059020909,0.999988896715596,0.999989703948879,0.999990480720734,0.999991227031138,0.999991942880066,0.999992628267498,0.999993283193413,0.999993907657790,0.999994501660611,0.999995065201858,0.999995598281513,0.999996100899561,0.999996573055985,0.999997014750771,0.999997425983907,0.999997806755379,0.999998157065176,0.999998476913288,0.999998766299704,0.999999025224415,0.999999253687414,0.999999451688695,0.999999619228249,0.999999756306074,0.999999862922164,0.999999939076517,0.999999984769129,1.000000000000000,0.999999984769129,0.999999939076517,0.999999862922164,0.999999756306074,0.999999619228249,0.999999451688695,0.999999253687414,0.999999025224415,0.999998766299704,0.999998476913288,0.999998157065176,0.999997806755379,0.999997425983907,0.999997014750771,0.999996573055985,0.999996100899561,0.999995598281513,0.999995065201858,0.999994501660611,0.999993907657790,0.999993283193413,0.999992628267498,0.999991942880066,0.999991227031138,0.999990480720734,0.999989703948879,0.999988896715596,0.999988059020909,0.999987190864844,0.999986292247427,0.999985363168686,0.999984403628648,0.999983413627344,0.999982393164803,0.999981342241057,0.999980260856137,0.999979149010077,0.999978006702909,0.999976833934670,0.999975630705395,0.999974397015120,0.999973132863883,0.999971838251722,0.999970513178678,0.999969157644790,0.999967771650099,0.999966355194648,0.999964908278481,0.999963430901640};

double mSin(float a)
{
    double a0=ABS(a)*100.0;
    int b=(int)(a0+0.5);
    double e=(a0-(double)b)*MORN_PI/18000.0;
    int c=(b+50)/100;int d=b-c*100+50;c=c%360;

    double sn=morn_sin1[d]+morn_cos1[d]*e;
    double cs=morn_cos1[d]-morn_sin1[d]*e;
    double rst=morn_sin0[c]*cs+morn_cos0[c]*sn;
    return (a>0)?rst:(0-rst);
}

double mCos(float a)
{
    double a0=ABS(a)*100.0;
    int b=(int)(a0+0.5);
    double e=(a0-(double)b)*MORN_PI/18000.0;
    int c=(b+50)/100;int d=b-c*100+50;c=c%360;

    double sn=morn_sin1[d]+morn_cos1[d]*e;
    double cs=morn_cos1[d]-morn_sin1[d]*e;
    double rst=morn_cos0[c]*cs-morn_sin0[c]*sn;
    return rst;
}

double morn_ln1[129]={0.0,0.693147180559945,1.38629436111989,2.07944154167984,2.77258872223978,3.46573590279973,4.15888308335967,4.85203026391962,5.54517744447956,6.23832462503951,6.93147180559945,7.62461898615940,8.31776616671934,9.01091334727929,9.70406052783923,10.3972077083992,11.0903548889591,11.7835020695191,12.4766492500790,13.1697964306390,13.8629436111989,14.5560907917589,15.2492379723188,15.9423851528787,16.6355323334387,17.3286795139986,18.0218266945586,18.7149738751185,19.4081210556785,20.1012682362384,20.7944154167984,21.4875625973583,22.1807097779182,22.8738569584782,23.5670041390381,24.2601513195981,24.9532985001580,25.6464456807180,26.3395928612779,27.0327400418379,27.7258872223978,28.4190344029578,29.1121815835177,29.8053287640777,30.4984759446376,31.1916231251975,31.8847703057575,32.5779174863174,33.2710646668774,33.9642118474373,34.6573590279973,35.3505062085572,36.0436533891172,36.7368005696771,37.4299477502370,38.1230949307970,38.8162421113569,39.5093892919169,40.2025364724768,40.8956836530368,41.5888308335967,42.2819780141567,42.9751251947166,43.6682723752766,44.3614195558365,45.0545667363964,45.7477139169564,46.4408610975163,47.1340082780763,47.8271554586362,48.5203026391962,49.2134498197561,49.9065970003161,50.5997441808760,51.2928913614360,51.9860385419959,52.6791857225559,53.3723329031158,54.0654800836757,54.7586272642357,55.4517744447956,56.1449216253556,56.8380688059155,57.5312159864755,58.2243631670354,58.9175103475954,59.6106575281553,60.3038047087152,60.9969518892752,61.6900990698351,62.3832462503951,63.0763934309550,63.7695406115150,64.4626877920749,65.1558349726349,65.8489821531948,66.5421293337547,67.2352765143147,67.9284236948746,68.6215708754346,69.3147180559945,70.0078652365545,70.7010124171144,71.3941595976744,72.0873067782343,72.7804539587943,73.4736011393542,74.1667483199141,74.8598955004741,75.5530426810340,76.2461898615940,76.9393370421539,77.6324842227139,78.3256314032738,79.0187785838338,79.7119257643937,80.4050729449537,81.0982201255136,81.7913673060736,82.4845144866335,83.1776616671934,83.8708088477534,84.5639560283133,85.2571032088733,85.9502503894332,86.6433975699932,87.3365447505531,88.0296919311131,88.7228391116730};
double morn_ln2[100]={0.0,0.009950330853168,0.019802627296180,0.029558802241544,0.039220713153281,0.048790164169432,0.058268908123976,0.067658648473815,0.076961041136128,0.086177696241052,0.095310179804325,0.104360015324243,0.113328685307003,0.122217632724249,0.131028262406404,0.139761942375159,0.148420005118273,0.157003748809665,0.165514438477574,0.173953307123438,0.182321556793955,0.190620359608650,0.198850858745165,0.207014169384326,0.215111379616946,0.223143551314210,0.231111720963387,0.239016900470500,0.246860077931526,0.254642218373581,0.262364264467491,0.270027137213060,0.277631736598280,0.285178942233663,0.292669613962820,0.300104592450338,0.307484699747961,0.314810739840034,0.322083499169114,0.329303747142601,0.336472236621213,0.343589704390077,0.350656871613170,0.357674444271816,0.364643113587910,0.371563556432483,0.378436435720245,0.385262400790645,0.392042087776024,0.398776119957368,0.405465108108165,0.412109650826833,0.418710334858185,0.425267735404344,0.431782416425538,0.438254930931156,0.444685821261446,0.451075619360217,0.457424847038876,0.463734016232140,0.470003629245736,0.476234178996372,0.482426149244293,0.488580014818671,0.494696241836107,0.500775287912490,0.506817602368452,0.512823626428664,0.518793793415168,0.524728528934982,0.530628251062171,0.536493370514569,0.542324290825362,0.548121408509688,0.553885113226438,0.559615787935423,0.565313809050061,0.570979546585738,0.576613364303994,0.582215619852664,0.587786664902119,0.593326845277735,0.598836501088704,0.604315966853330,0.609765571620895,0.615185639090234,0.620576487725110,0.625938430866496,0.631271776841858,0.636576829071551,0.641853886172395,0.647103242058539,0.652325186039691,0.657520002916795,0.662687973075237,0.667829372575656,0.672944473242426,0.678033542749898,0.683096844706444,0.688134638736401};
double mLn(float a)
{
    if(a<=0.0) return mNan();
    
    int *b=(int *)(&a);
    int c=((*b)>>23)-127;
    double rst=(c>0)?morn_ln1[c]:(0-morn_ln1[0-c]);

    *b=((*b)&0xbfffffff)|0x3f800000;
    double f=(double)a;
    
    int d=(int)(f*100.0);
    rst+=morn_ln2[d-100];

    f=(f*100.0/(double)d)-1.0;
    double e=f*f;rst=rst+f-e/2.0;
           e=e*f;rst=rst+  e/3.0;
           e=e*f;rst=rst-  e/4.0;
    
    return rst;
}

double morn_exp1[71]={1.0,2.202646579480672e+004,4.851651954097903e+008,1.068647458152446e+013,2.353852668370200e+017,5.184705528587072e+021,1.142007389815684e+026,2.515438670919167e+030,5.540622384393510e+034,1.220403294317841e+039,2.688117141816136e+043,5.920972027664670e+047,1.304180878393632e+052,2.872649550817832e+056,6.327431707155585e+060,1.393709580666380e+065,3.069849640644242e+069,6.761793810485009e+073,1.489384200781838e+078,3.280587015384671e+082,7.225973768125749e+086,1.591626640377924e+091,3.505790975238748e+095,7.722018499983836e+099,1.700887763567586e+104,3.746454614502673e+108,8.252115441813891e+112,1.817649385139100e+117,4.003639200871785e+121,8.818602191274965e+125,1.942426395241256e+130,4.278478855371123e+134,9.423976816163585e+138,2.075769029922787e+143,4.572185553551339e+147,1.007090887028080e+152,2.218265297538556e+156,4.886054470003974e+160,1.076225116551050e+165,2.370543571722357e+169,5.221469689764144e+173,1.150105235202100e+178,2.533275362360718e+182,5.579910311786494e+186,1.229057036206545e+191,2.707178276786998e+195,5.962956971409261e+199,1.313428677666503e+204,2.893019184253945e+208,6.372298810568915e+212,1.403592217852838e+217,3.091617597639242e+221,6.809740926502327e+225,1.499945255890989e+230,3.303849287296548e+234,7.277212331783397e+238,1.602912685075726e+243,3.530650142988227e+247,7.776774460795963e+251,1.712948566546487e+256,3.773020300929940e+260,8.310630260154467e+264,1.830538131585780e+269,4.032028554146358e+273,8.881133903158874e+277,1.956199921370272e+282,4.308817065586588e+286,9.490801171122244e+290,2.090488073610356e+295,4.604606404782990e+299};
double morn_exp2[70]={1.0,4.539992976248485e-005,2.061153622438558e-009,9.357622968840175e-014,4.248354255291589e-018,1.928749847963918e-022,8.756510762696520e-027,3.975449735908647e-031,1.804851387845415e-035,8.194012623990515e-040,3.720075976020836e-044,1.688911880224532e-048,7.667648073722000e-053,3.481106839904311e-057,1.580420060273613e-061,7.175095973164411e-066,3.257488532207521e-070,1.478897505643213e-074,6.714184288211594e-079,3.048234950971857e-083,1.383896526736738e-087,6.282880511239462e-092,2.852423339163565e-096,1.294998192508984e-100,5.879282698245269e-105,2.669190215541276e-109,1.211810483082857e-113,5.501611081740457e-118,2.497727566915251e-122,1.133966561037746e-126,5.148200222412014e-131,2.337279285007143e-135,1.061123153746351e-139,4.817491664943076e-144,2.187137832197718e-148,9.929590396264980e-153,4.508027065606742e-157,2.046641121459268e-161,9.291736316326398e-166,4.218441761327482e-170,1.915169596714006e-174,8.694856517406230e-179,3.947458751851265e-183,1.792143500743535e-187,8.136318905805023e-192,3.693883068487256e-196,1.677020318601535e-200,7.613660467476964e-205,3.456596504588617e-209,1.569292385255739e-213,7.124576406741286e-218,3.234552684535111e-222,1.468484646909508e-226,6.666909982697905e-231,3.026772449472940e-235,1.374152566130957e-239,6.238642998528377e-244,2.832339539464062e-248,1.285880161551771e-252,5.837886901742308e-257,2.650396553004311e-261,1.203278173491277e-265,5.462874456123503e-270,2.480141166092796e-274,1.125982347416602e-278,5.111951948651156e-283,2.320822594179601e-287,1.053651827669418e-291,4.783571897030535e-296,2.171738281389827e-300};
double morn_exp3[101]={1.000000000000000,1.105170918075648,1.221402758160170,1.349858807576003,1.491824697641270,1.648721270700128,1.822118800390509,2.013752707470477,2.225540928492467,2.459603111156949,2.718281828459045,3.004166023946433,3.320116922736547,3.669296667619244,4.055199966844675,4.481689070338065,4.953032424395117,5.473947391727202,6.049647464412949,6.685894442279273,7.389056098930653,8.166169912567655,9.025013499434127,9.974182454814727,11.023176380641610,12.182493960703484,13.463738035001704,14.879731724872849,16.444646771097069,18.174145369443085,20.085536923187693,22.197951281441664,24.532530197109384,27.112638920657929,29.964100047397064,33.115451958692375,36.598234443678059,40.447304360067470,44.701184493300914,49.402449105530280,54.598150033144336,60.340287597362057,66.686331040925211,73.699793699595844,81.450868664968141,90.017131300521811,99.484315641933776,109.94717245212343,121.51041751873476,134.28977968493530,148.41315910257634,164.02190729990139,181.27224187515074,200.33680997479112,221.40641620418637,244.69193226421953,270.42640742615157,298.86740096705898,330.29955990964714,365.03746786532696,403.42879349273295,445.85777008251438,492.74904109325325,544.57191012592557,601.84503787207802,665.14163304435715,735.09518924196743,812.40582516753682,897.84729165041040,992.27471560501738,1096.6331584284490,1211.9670744925654,1339.4307643944051,1480.2999275845305,1635.9844299959097,1808.0424144560438,1998.1958951040961,2208.3479918871835,2440.6019776244702,2697.2823282684762,2980.9579870416910,3294.4680752837994,3640.9503073323067,4023.8723938222556,4447.0667476997942,4914.7688402990643,5431.6595913629008,6002.9122172609323,6634.2440062777841,7331.9735391558779,8103.0839275752542,8955.2927034823661,9897.1290587437506,10938.019208164997,12088.380730216773,13359.726829661635,14764.781565577005,16317.607198015130,18033.744927828171,19930.370438229907,22026.465794806718};
double morn_exp4[101]={1.000000000000000,1.001000500166708,1.002002001334000,1.003004504503377,1.004008010677342,1.005012520859401,1.006018036054065,1.007024557266849,1.008032085504274,1.009040621773868,1.010050167084168,1.011060722444720,1.012072288866078,1.013084867359809,1.014098458938492,1.015113064615719,1.016128685406095,1.017145322325241,1.018162976389794,1.019181648617408,1.020201340026756,1.021222051637529,1.022243784470438,1.023266539547218,1.024290317890622,1.025315120524429,1.026340948473442,1.027367802763489,1.028395684421425,1.029424594475131,1.030454533953517,1.031485503886523,1.032517505305119,1.033550539241306,1.034584606728118,1.035619708799623,1.036655846490924,1.037693020838157,1.038731232878498,1.039770483650158,1.040810774192388,1.041852105545480,1.042894478750763,1.043937894850613,1.044982354888444,1.046027859908717,1.047074410956937,1.048122009079656,1.049170655324471,1.050220350740028,1.051271096376024,1.052322893283204,1.053375742513365,1.054429645119356,1.055484602155080,1.056540614675494,1.057597683736611,1.058655810395500,1.059714995710288,1.060775240740159,1.061836546545360,1.062898914187195,1.063962344728034,1.065026839231306,1.066092398761505,1.067159024384193,1.068226717165993,1.069295478174600,1.070365308478774,1.071436209148346,1.072508181254217,1.073581225868358,1.074655344063814,1.075730536914703,1.076806805496220,1.077884150884632,1.078962574157284,1.080042076392600,1.081122658670083,1.082204322070315,1.083287067674959,1.084370896566760,1.085455809829549,1.086541808548238,1.087628893808826,1.088717066698399,1.089806328305129,1.090896679718278,1.091988122028198,1.093080656326330,1.094174283705210,1.095269005258466,1.096364822080817,1.097461735268082,1.098559745917174,1.099658855126103,1.100759063993979,1.101860373621011,1.102962785108508,1.104066299558882,1.105170918075648};
double mExp(double a)
{
    if((a>700.0)||(a<-700)) return mNan();
    double f=a;
    int b=(int)(f*1000.0);
    f-=(double)(b)/1000.0;
    int c=b/10000-(a<0);b-=c*10000;
    double rst=(a<0)?morn_exp2[0-c]:morn_exp1[c];
    
    int d=b/100;int e=b%100;
    rst=rst*morn_exp3[d]*morn_exp4[e];
    
    double g=f*f;
    double h =1+f+g/2.0;
    g*=f;  h+=g/ 6.0;
    g*=f;  h+=g/24.0;

    rst=rst*h;
    return rst;
}


void mMean(float *in,int num,float *sum,float *mean)
{
    float m;
    int i;
    mException((INVALID_POINTER(in))||(num <= 0),EXIT,"invalid input");
    
    m = 0.0f;
    for(i=0;i<num;i++)
        m = m + in[i];
    
    if(!INVALID_POINTER(sum)) *sum = m;
    if(!INVALID_POINTER(mean)) *mean = m/((float)num);
}

void mVariance(float *in,int num,float *mean,float *variance)
{
    float sum=0.0f;
    float var=0.0f;
    int i;
    mException((INVALID_POINTER(in))||(num <= 0)||(INVALID_POINTER(variance)),EXIT,"invalid input");
    
    for(i=0;i<num;i++)
    {
        sum = sum + in[i];
        var = var + in[i]*in[i];
    }
    sum = sum/((float)num);
    if(!INVALID_POINTER(mean)) *mean = sum;
    *variance = var/((float)num) - (sum*sum);
}

void mCovariance(float *in1,float *in2,int num,float *mean1,float *mean2,float *covariance)
{
    float sum1 = 0.0f;
    float sum2 = 0.0f;
    float cosum = 0.0f;
    int i;
    
    mException((INVALID_POINTER(in1))||(INVALID_POINTER(in2))||(num <= 0)||(INVALID_POINTER(covariance)),EXIT,"invalid input");
    for(i=0;i<num;i++)
    {
        sum1 =sum1 + in1[i];
        sum2 =sum2 + in2[i];
        cosum = cosum +in1[i] * in2[i];
    }
    sum1 = sum1/((float)num);
    sum2 = sum2/((float)num);
    if(!INVALID_POINTER(mean1)) *mean1 = sum1;
    if(!INVALID_POINTER(mean2)) *mean2 = sum1;
    *covariance = cosum/((float)num) - sum1*sum2;
}

#define MID_INDEX(I1,I2,I3) (((value[I1]>value[I2])==(value[I2]>=value[I3]))?I2:(((value[I1]>value[I2])==(value[I3]>=value[I1]))?I1:I3))
void mApproxMidValue(float *value,int num,float *mid,int *idx)
{
    int n;for(n=9;n<num/4;n=n*3);
    int *index = (int *)mMalloc(sizeof(int)*n);
    float step = (float)num/(float)n;for(int i=0;i<n;i++) index[i] = i*step;
    for(;n>1;n=n/3)
    {
        for(int i=0,j=0;i<n;i+=3,j+=1)
        {
            printf("%f,%f,%f",value[index[i]],value[index[i+1]],value[index[i+2]]);
            index[j] = MID_INDEX(index[i],index[i+1],index[i+2]);
            printf("-->%f\n",value[index[j]]);
        }
        printf("\n");
    }
    
    if(mid != NULL) *mid = value[index[0]];
    if(idx != NULL) *idx = index[0];
    
    mFree(index);
}



int _GreatestCommonDivisor(int a,int b)
{
    return b?_GreatestCommonDivisor(b,a%b):a;
}
int GreatestCommonDivisor(int n,...)
{
    va_list para;
    va_start(para,n);
    int a=va_arg(para,int);
    for(int i=1;i<n;i++)
    {
        int b=va_arg(para,int);
        a=_GreatestCommonDivisor(b,a);
    }
    va_end(para);
    return a;
}
int _LowestCommonMultiple(int a,int b)
{
    return (a/_GreatestCommonDivisor(a,b)*b);
}
int LowestCommonMultiple(int n,...)
{
    va_list para;
    va_start(para,n);
    int a=va_arg(para,int);
    for(int i=1;i<n;i++)
    {
        int b=va_arg(para,int);
        a=_LowestCommonMultiple(a,b);
    }
    va_end(para);
    return a;
}

int mBinaryCeil(int data)
{
    int floor = mBinaryFloor(data);
    if(floor==data) return data;
    return (data>0)?(floor*2):(floor/2);
}

int mBinaryFloor(int data)
{
    if (data<0) return (0-mBinaryCeil(0-data));
    int v[16]={0,1,2,2,4,4,4,4,8,8,8,8,8,8,8,8};
    if(data<16) return v[data];
    if(data<256) return (v[data>>4]<<4);
    if(data<4096) return (v[data>>8]<<8);
    if(data<65536) return (v[data>>12]<<12);
    if(data<1048576) return (v[data>>16]<<16);
    if(data<16777216) return (v[data>>20]<<20);
    if(data<268435456) return (v[data>>24]<<24);
    return (v[data>>28]<<28);
}

int mBinaryRound(int data)
{
    int floor = mBinaryFloor(data);
    int ceil = (data>0)?(floor*2):(floor/2);
    return ((ceil-data)<=(data-floor))?ceil:floor;
}

double mSigmoid(float x)
{
    return (1.0/(1.0+exp((double)(0.0f-x))));
}

unsigned int m_Hash(const char *in,int size)
{
    unsigned int out;
    int i;
    
    mException(INVALID_POINTER(in),EXIT,"invalid input");
    
    out = 0x811C9DC5;
    for(i=0;(size<=0)?(in[i]!='\0'):(i<=size);i++)
    {
        out = out^(unsigned int)in[i];
        out = (out<<24)+(out<<8)+(out<<6)+(out<<4)+(out<<3)+(out<<2)+out;
    }
    
    return out;
}
/*
struct HandlePermutation
{
    int *idx;
    int *flag;
    int num;
    int total;
};
void endPermutation(struct HandlePermutation *handle)
{
    if(handle->idx !=NULL) mFree(handle->idx );
    if(handle->flag!=NULL) mFree(handle->flag);
}
#define HASH_Permutation 0xf4740f4b
int mPermutation(int *idx,int num,int total)
{
    mException(INVALID_POINTER(idx),EXIT,"invalid input");
    MHandle *hdl = mHandle(mMornObject(idx,0),Permutation);
    struct HandlePermutation *handle = (struct HandlePermutation *)(hdl->handle);
    if(hdl->valid==0)
    {
        if(total<0) total=num;
        mException((num<0)||(num>total),EXIT,"invalid input combination number");
        if((handle->idx!=NULL)&&(handle->num<num)) {mFree(handle->idx);handle->idx=NULL;}
        if(handle->idx==NULL) handle->idx = (int *)mMalloc(num*sizeof(int));
        if((handle->flag!=NULL)&&(handle->total<total)) {mFree(handle->flag);handle->flag=NULL;}
        if(handle->flag==NULL) handle->flag= (int *)mMalloc(total*sizeof(int));
        for(int i=0;i<num;i++) {handle->idx[i]=i;handle->flag[i]=1;}
        for(int i=num;i<total;i++) handle->flag[i]=0;
        handle->num = num;handle->total=total;
        hdl->valid = 1;
        
        memcpy(idx,handle->idx,num*sizeof(int));
        return MORN_SUCCESS;
    }
    else
    {
        mException((handle->num  !=num  )&&(num  >0),EXIT,"invalid input combination number");num  =handle->num  ;
        mException((handle->total!=total)&&(total>0),EXIT,"invalid input combination number");total=handle->total;
    }

    int n;for(n=num-1;n>=0;n--)
    {
        int j = handle->idx[n];
        handle->flag[j]=0;
        for(j=handle->idx[n]+1;j<total;j++)
        {
            if(handle->flag[j]==0)
            {
                handle->idx[n]=j;
                handle->flag[j]=1;
                break;
            }
        }
        if(j<total) break;
        if(n==0) 
        {
            mFree(handle->idx );handle->idx =NULL;
            mFree(handle->flag);handle->flag=NULL;
            hdl->valid = 0;
            return MORN_FAIL;
        }
    }
    for(int i=n+1;i<num;i++)
    {
        for(int j=0;j<total;j++)
        {
            if(handle->flag[j]==0)
            {
                handle->idx[i]=j;
                handle->flag[j]=1;
                break;
            }
        }
    }
    memcpy(idx,handle->idx,num*sizeof(int));
    return MORN_SUCCESS;
}
*/


struct HandleCombination
{
    int *idx;
    int num;
    int array_num;
    int order;
};
void endCombination(struct HandleCombination *handle)
{
    if(handle->idx!=NULL) mFree(handle->idx);
}
#define HASH_Combination 0x110249ec
// int mCombination(int *idx,int num,int total)
int mCombination(MArray *array,int num)
{
    mException(INVALID_POINTER(array),EXIT,"invalid input");
    int array_num = array->num;
    MHandle *hdl = mHandle(array,Combination);
    struct HandleCombination *handle = (struct HandleCombination *)(hdl->handle);
    if(hdl->valid==0)
    {
        mException((num<0)||(num>array_num),EXIT,"invalid input combination number");
        if((handle->idx!=NULL)&&(handle->num<num)) {mFree(handle->idx);handle->idx=NULL;}
        if(handle->idx==NULL) handle->idx = (int *)mMalloc(num*sizeof(int));
        for(int i=0;i<num;i++) handle->idx[i]=i;
        handle->num = num;handle->array_num=array_num;
        hdl->valid = 1;

        memcpy(array->dataS32,handle->idx,num*sizeof(int));
        handle->order = 0;
        return handle->order;
    }
    mException((handle->num !=num)&&(num > 0),EXIT,"invalid input combination number");num=handle->num;
    mException((handle->array_num!=array_num),EXIT,"invalid input combination number");

    int n;for(n=num-1;n>=0;n--)
    {
        handle->idx[n]++;
        if(handle->idx[n]<=array_num-num+n) break;
    }
    if(n<0) 
    {
        mFree(handle->idx);handle->idx =NULL;
        hdl->valid = 0;
        return DFLT;
    }
    for(int i=n+1;i<num;i++) handle->idx[i]=handle->idx[i-1]+1;
    
    memcpy(array->dataS32,handle->idx,num*sizeof(int));
    handle->order++;
    return handle->order;
}

int m_Permutation(int *idx,int num)
{
    int buff;
    if(idx[num-2]<idx[num-1]) {buff=idx[num-2];idx[num-2]=idx[num-1];idx[num-1]=buff;return 1;}
    int n;for(n=num-3;n>=0;n--)
    {
        if(idx[n]<idx[n+1]) break;
    }
    if(n<0) return DFLT;
    int i,j;
    for(i=num-1;i>n;i--) {if(idx[i]>idx[n]) {buff=idx[n];idx[n]=idx[i];idx[i]=buff;break;}}
    for(i=num-1,j=n+1;i>j;i--,j++) {buff=idx[j];idx[j]=idx[i];idx[i]=buff;}
    return 1;
}

int mPermutation(MArray *array,int num)
{
    mException(INVALID_POINTER(array),EXIT,"invalid input");
    MHandle *hdl = mHandle(array,Combination);
    struct HandleCombination *handle = (struct HandleCombination *)(hdl->handle);

    if(hdl->valid==0) {mCombination(array,num);return 0;}
    
    if(m_Permutation(array->dataS32,num)>0) {handle->order++;return handle->order;}
    if(mCombination(array,num)>0) return handle->order;
    return -1;
}
